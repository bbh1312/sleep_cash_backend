# π› μ¬λ¦½μΊμ‹ μλ©΄ κΈ°λ¥ ν”„λ΅ νΈμ—”λ“ κ°λ° μ§€μΉ¨μ„

## π― μ „μ²΄ ν”λ΅μ° κ°μ”

### μλ©΄ λ¨λ“ μ§„μ… μ΅°κ±΄
- GNB "μλ©΄" ν΄λ¦­ λλ” ν™ μλ©΄ λ°°λ„ ν΄λ¦­
- κΈμΌ μλ©΄ ν”λ΅μ° μ™„λ£ μ‹ β†’ λ°”λ΅ μλ©΄ ν™”λ©΄μΌλ΅ μ΄λ™
- λ―Έμ™„λ£ μ‹ β†’ κ΄‘κ³  νμ—… β†’ κΈ°λ¶„ μ„ νƒ β†’ λ°±μƒ‰μ†μ μ„ νƒ β†’ μλ©΄ ν™”λ©΄

### μλ©΄ ν”λ΅μ° λ‹¨κ³„
1. **κ΄‘κ³  νμ—…** (μ²« μ§„μ… μ‹λ§)
2. **κΈ°λ¶„ μ„ νƒ ν™”λ©΄**
3. **λ°±μƒ‰μ†μ μ„ νƒ ν™”λ©΄**
4. **μλ©΄ ν™”λ©΄** (λ©”μΈ)
5. **μλ©΄ μΆ…λ£ νμ—…**

## π’° ν¬μΈνΈ μ‹μ¤ν…

### νƒ€μ΄λ¨Έ ν¬μΈνΈ
- 1λ¶„λ‹Ή 0.5P μ λ¦½
- ν•λ£¨ μµλ€ 200P
- pending μƒνƒ β†’ κ΄‘κ³  μ‹μ²­ β†’ claimed μƒνƒλ΅ λ³€ν™

### μ¤‘κ°„ νλ“ ν¬μΈνΈ
- 1νλ‹Ή 10P
- ν•λ£¨ μµλ€ 5ν (50P)
- κ΄‘κ³  μ‹μ²­ μ¦‰μ‹ User.total_pointsμ— λ°μ

### μΌμΌ ν•λ„
- μ •μ¤ 12:00 ~ λ‹¤μλ‚  11:59:59 κΈ°μ¤€
- μ΄ μµλ€ 250P/μΌ (νƒ€μ΄λ¨Έ 200P + μ¤‘κ°„ νλ“ 50P)

## π” μΈμ¦
λ¨λ“  API μ”μ²­ μ‹ ν—¤λ”μ— JWT ν† ν° ν¬ν•¨:
```
Authorization: Bearer {JWT_TOKEN}
```

## π“‹ API μ—”λ“ν¬μΈνΈ

### 1. μλ©΄ μ„Έμ… μ‹μ‘
**POST** `/api/sleep/start`

**μ”μ²­ λ°μ΄ν„°:**
- mood (μ„ νƒ): κΈ°λ¶„
- memo (μ„ νƒ): λ©”λ¨
- white_noise_type (μ„ νƒ): λ°±μƒ‰μ†μ μΆ…λ¥
- white_noise_volume (μ„ νƒ): λ°±μƒ‰μ†μ λ³Όλ¥¨

**μ‘λ‹µ λ°μ΄ν„°:**
- session_id: μ„Έμ… ID
- started_at: μ‹μ‘ μ‹κ°„
- status: μ„Έμ… μƒνƒ

### 2. μλ©΄ μƒνƒ μ΅°ν
**GET** `/api/sleep/status`

**μ‘λ‹µ λ°μ΄ν„°:**
- session_id: ν„μ¬ μ„Έμ… ID
- elapsed_minutes: κ²½κ³Ό μ‹κ°„(λ¶„)
- timer_points: νƒ€μ΄λ¨Έ ν¬μΈνΈ μ •λ³΄
  - pending_points: λ€κΈ° μ¤‘μΈ ν¬μΈνΈ
  - claimed_points: νλ“ν• ν¬μΈνΈ
  - remaining_limit: λ‚¨μ€ ν•λ„
- intermediate_points: μ¤‘κ°„ νλ“ ν¬μΈνΈ μ •λ³΄
  - claimed_count: νλ“ νμ
  - remaining_claims: λ‚¨μ€ νμ
  - claimed_points: νλ“ν• ν¬μΈνΈ

### 3. μ¤‘κ°„ ν¬μΈνΈ νλ“
**POST** `/api/sleep/claim-intermediate`

**μ‘λ‹µ λ°μ΄ν„°:**
- claim_sequence: νλ“ μμ„ (1~5)
- points_awarded: νλ“ ν¬μΈνΈ (10P)
- new_total_points: μ—…λ°μ΄νΈλ μ΄ ν¬μΈνΈ
- remaining_claims: λ‚¨μ€ νλ“ νμ

### 4. μλ©΄ μ„Έμ… μΆ…λ£
**POST** `/api/sleep/end`

**μ‘λ‹µ λ°μ΄ν„°:**
- total_minutes: μ΄ μλ©΄ μ‹κ°„
- timer_points: νƒ€μ΄λ¨Έ ν¬μΈνΈ μ”μ•½
- intermediate_points: μ¤‘κ°„ νλ“ ν¬μΈνΈ μ”μ•½

### 5. νƒ€μ΄λ¨Έ ν¬μΈνΈ νλ“ (κ΄‘κ³  μ‹μ²­)
**POST** `/api/sleep/claim-timer`

**μ‘λ‹µ λ°μ΄ν„°:**
- claimed_points: νλ“ν• ν¬μΈνΈ
- new_total_points: μ—…λ°μ΄νΈλ μ΄ ν¬μΈνΈ

### 6. μΌμΌ μλ©΄ ν„ν™© μ΅°ν
**GET** `/api/sleep/daily-status`

**μ‘λ‹µ λ°μ΄ν„°:**
- timer_points: νƒ€μ΄λ¨Έ ν¬μΈνΈ ν„ν™©
- intermediate_points: μ¤‘κ°„ νλ“ ν¬μΈνΈ ν„ν™©
- sleep_flow_completed: μ¤λ ν”λ΅μ° μ™„λ£ μ—¬λ¶€
- current_session: ν„μ¬ μ„Έμ… μ •λ³΄

## π¨ UI/UX μ”κµ¬μ‚¬ν•­

### μλ©΄ ν™”λ©΄ κµ¬μ„±
1. **νƒ€μ΄λ¨Έ μμ—­**
   - 00:59 β†’ 00:00 μΉ΄μ΄νΈλ‹¤μ΄ ν‘μ‹
   - λ¶„λ§λ‹¤ +0.5P μ‹κ°μ  ν¨κ³Ό

2. **νƒ€μ΄λ¨Έ ν¬μΈνΈ μμ—­**
   - ν„μ¬ pending ν¬μΈνΈ ν‘μ‹
   - μ¤λ μ λ¦½ κ°€λ¥λ‰ ν‘μ‹ (200P μ¤‘ λ‚¨μ€ μ–‘)

3. **μ¤‘κ°„ νλ“ ν¬μΈνΈ λ²„νΌ**
   - "π ν¬μΈνΈ λ°›κΈ° (X/5)" ν•νƒ
   - λ‚¨μ€ νμ μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ
   - 5ν μ™„λ£ μ‹ λΉ„ν™μ„±ν™”

4. **ν„μ¬ μ„¤μ • μ”μ•½**
   - μ„ νƒν• κΈ°λ¶„
   - λ°±μƒ‰μ†μ μΆ…λ¥ λ° λ³Όλ¥¨

5. **μλ©΄ μΆ…λ£ λ²„νΌ**
   - λμ— λ„κ² κ°•μ΅° ν‘μ‹

### μλ©΄ μΆ…λ£ νμ—…
1. **μλ©΄ μ”μ•½**
   - μ΄ μλ©΄ μ‹κ°„ ν‘μ‹

2. **ν¬μΈνΈ μ”μ•½ (λ¶„λ¦¬ ν‘μ‹)**
   - νƒ€μ΄λ¨Έ ν¬μΈνΈ: pending + κ΄‘κ³  λ³΄λ„μ¤
   - μ¤‘κ°„ νλ“ ν¬μΈνΈ: μ΄λ―Έ λ°›μ€ ν¬μΈνΈ

3. **μ•΅μ… λ²„νΌ**
   - "κ΄‘κ³  λ³΄κ³  ν¬μΈνΈ λ°›κΈ°"
   - "ν¬μΈνΈ μ—†μ΄ μΆ…λ£"

### μ¤‘κ°„ ν¬μΈνΈ νλ“ ν”λ΅μ°
1. μ¤‘κ°„ νλ“ λ²„νΌ ν΄λ¦­
2. κ΄‘κ³  μ¬μƒ
3. κ΄‘κ³  μ™„λ£ μ‹ μ¦‰μ‹ ν¬μΈνΈ μ§€κΈ‰
4. μ„±κ³µ ν† μ¤νΈ λ©”μ‹μ§€ ν‘μ‹
5. λ²„νΌ μƒνƒ μ—…λ°μ΄νΈ (λ‚¨μ€ νμ κ°μ†)

## π“± λ΅μ»¬ μ¤ν† λ¦¬μ§€ κ΄€λ¦¬

### μλ©΄ ν”λ΅μ° μ™„λ£ μƒνƒ
- ν‚¤: `sleep_flow_{YYYY-MM-DD}`
- κ°’: "true" (μ™„λ£ μ‹)
- μ •μ¤ κΈ°μ¤€ λ‚ μ§ κ³„μ‚° ν•„μ”

### λ‚ μ§ κ³„μ‚° λ΅μ§
- ν„μ¬ μ‹κ°„μ΄ 12:00 μ΄ν›„λ©΄ β†’ μ¤λ λ‚ μ§
- ν„μ¬ μ‹κ°„μ΄ 12:00 μ΄μ „μ΄λ©΄ β†’ μ–΄μ  λ‚ μ§

## π”„ μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ

### μƒνƒ ν΄λ§
- 30-60μ΄λ§λ‹¤ `/api/sleep/status` νΈμ¶
- pending ν¬μΈνΈ, κ²½κ³Ό μ‹κ°„ μ—…λ°μ΄νΈ
- μ¤‘κ°„ νλ“ λ²„νΌ μƒνƒ μ—…λ°μ΄νΈ

### νƒ€μ΄λ¨Έ UI λ™μ‘
- ν΄λΌμ΄μ–ΈνΈμ—μ„ 59μ΄ β†’ 0μ΄ μΉ΄μ΄νΈλ‹¤μ΄
- 0μ΄ λ„λ‹¬ μ‹ +0.5P μ‹κ°μ  ν¨κ³Ό
- μ‹¤μ  ν¬μΈνΈλ” μ„λ²„ μ‘λ‹µ κΈ°μ¤€μΌλ΅ ν‘μ‹

## β οΈ μ—λ¬ μ²λ¦¬

### μ¤‘κ°„ ν¬μΈνΈ κ΄€λ ¨ μ—λ¬
- `INTERMEDIATE_LIMIT_REACHED`: "μ¤λ μ¤‘κ°„ ν¬μΈνΈλ¥Ό λ¨λ‘ λ°›μ•μ–΄μ”!"
- `NO_ACTIVE_SESSION`: "ν™μ„±ν™”λ μλ©΄ μ„Έμ…μ΄ μ—†μµλ‹λ‹¤."

### νƒ€μ΄λ¨Έ ν¬μΈνΈ κ΄€λ ¨ μ—λ¬
- `DAILY_LIMIT_REACHED`: "μ¤λ μ λ¦½ ν•λ„μ— λ„λ‹¬ν–μ–΄μ”!"
- `NO_PENDING_POINTS`: "λ°›μ„ μ μλ” ν¬μΈνΈκ°€ μ—†μ–΄μ”."

### κ΄‘κ³  κ΄€λ ¨ μ—λ¬
- `AD_PLAY_FAILED`: "κ΄‘κ³  μ¬μƒμ— μ‹¤ν¨ν–μ–΄μ”. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”."

## π« μλ©΄ ν™”λ©΄ μ΄νƒ λ°©μ§€

### μ΄νƒ κ°μ§€
- Android BackHandler μ΄λ²¤νΈ
- Navigation blur μ΄λ²¤νΈ
- λΈλΌμ°μ € νƒ­ λ³€κ²½ κ°μ§€

### ν™•μΈ νμ—…
- λ©”μ‹μ§€: "μ§€κΈ λ‚κ°€λ©΄ ν¬μΈνΈ μ λ¦½μ΄ μ¤‘λ‹¨λΌμ”. κ·Έλλ„ μΆ…λ£ν• κΉμ”?"
- λ²„νΌ: "μ" (μ„Έμ… μΆ…λ£) / "μ•„λ‹μ¤" (μλ©΄ ν™”λ©΄ μ μ§€)

## π― ν•µμ‹¬ κµ¬ν„ ν¬μΈνΈ

### 1. ν¬μΈνΈ μ‹μ¤ν… λ¶„λ¦¬ ν‘μ‹
- νƒ€μ΄λ¨Έ ν¬μΈνΈμ™€ μ¤‘κ°„ νλ“ ν¬μΈνΈλ¥Ό λ…ν™•ν κµ¬λ¶„
- κ°κ°μ ν•λ„μ™€ ν„ν™©μ„ λ³„λ„λ΅ ν‘μ‹

### 2. μ‹¤μ‹κ°„ λ™κΈ°ν™”
- μ„λ²„ μ‹κ°„ κΈ°μ¤€μΌλ΅ μ •ν™•ν• ν¬μΈνΈ κ³„μ‚°
- ν΄λΌμ΄μ–ΈνΈ νƒ€μ΄λ¨Έλ” UI μ—°μ¶μ©

### 3. μ‚¬μ©μ κ²½ν— μµμ ν™”
- μ¤‘κ°„ νλ“ λ²„νΌμ„ λμ— λ„κ² λ°°μΉ
- λ‚¨μ€ νμλ¥Ό μ‹¤μ‹κ°„μΌλ΅ ν‘μ‹
- κ΄‘κ³  μ™„λ£ μ‹ μ¦‰κ°μ μΈ ν”Όλ“λ°±

### 4. μ •μ¤ κΈ°μ¤€ λ‚ μ§ μ²λ¦¬
- λ¨λ“  μΌμΌ ν•λ„λ” μ •μ¤ 12:00 κΈ°μ¤€
- λ΅μ»¬ μ¤ν† λ¦¬μ§€ ν‚¤λ„ μ •μ¤ κΈ°μ¤€ λ‚ μ§ μ‚¬μ©

### 5. μ—λ¬ μƒν™© λ€μ‘
- λ„¤νΈμ›ν¬ μ¤λ¥ μ‹ μ¬μ‹λ„ λ΅μ§
- κ΄‘κ³  μ‹¤ν¨ μ‹ μ‚¬μ©μ μΉν™”μ  λ©”μ‹μ§€
- ν•λ„ λ„λ‹¬ μ‹ λ…ν™•ν• μ•λ‚΄
